## 멀티스레드

- Thread

  정의 : 하나의 프로세스를 **다수의 실행 단위**로 구분하여 자원을 공유하고 자원의 생성과 관리의 중복성을 최소화하여 수행 능력을 향상시키는 것을 **멀티쓰레딩**이라고 한다
  즉, 하나의 프로그램에 동시에 여러개의 일을 수행할수 있도록 해주는 것이다 

  일반적으로 프로그램을 실행하게 되면, main()함수가 실행되면서, 하나의 프로세서가 진행되는 이런 하나의 프로세스를 메인 스레드라고 한다.

  메인 스레드가 하나만 있는 것을 싱글 스레드(single thread)

  스레드가 여러개 있는 것 멀티 스레드(Multi thread) 라고 한다

  

- Multi Thread의 구현

  멀티스레드를 구현하기 위해서 일반적으로 두가지 방법이 있다

  - Java.lang.Thread 클래스 이용

    장점 : 스레드 클래스의 메소드를 바로 사용 가능

    단점 : 프로그램하려는 클래스가 다른 클래스로부터 상속받을 경우 사용할 수 없음

  - 사용방법

    1. Thread 클래스를 상속 받아서 내가 시킬 일을 해줄 클래스를 하나 만든다
    2. 위에서 만든 클래스에 run()메소드 안에 시킬 일을 정의해 준다
    3. 메인스레드에서 위에서 만든 클래스의 start() 메소드를 호출한다.

    start() 메소드 안에는 thread를 생성시켜서 일을 시키기 위한 여러가지 준비작업을 수행한 뒤에 준비가 끝나면 최종적으로 run()메소드를 호출해서 스레드가 자신의 일을 처리해나가게 된다.

    **주의할 점**

    run() 메소드를 바로 호출하면 안되고, start() 메소드를 호출해야 한다.

    run() 메소드를 바로 호출하게 되면 thread를 만들어서 실행하기 위한 처리가 안되고 그냥 run()메소드안에 정된 일을 main스레드에서 처리해 버리기 때문이다.

    별도의 thread를 만들어서 수행해야하므로, 반드시 start()메소드를 호출해서 일을 시키도록 해야한다.

    

  - Java.long.Runnable 인터페이스 이용

    1. Runnable 인터페이스와 Thread 2개의 클래스를 모두 사용하는 방법

    2. 보통 Runnable 인터페이스를 이용하여 만드는 경우가 많다.

       다른 기능을 갖는 부모로부터 상속 받기위해서 그렇다.

     장점 : 다른 클래스로부터 상속받은 후, 그 클래스를 스레드로 사용 가능

  ​	단점 : 스레드 클래스의 메소드 사용 불가

  - 사용방법
    1. 우선 Runnable 인터페이스를 구현하는 클래스를 하나 만든다
    2. 위에서 만든 클래스의 run() 메소드에 시킬 일을 정의한다
    3. **위에서 만든 클래스를 생성하고, Thread를 생성할 때 인자로 넣어서 생성한다.**
    4. Thread의 star() 메소드를 호출하여 새로운 스레드가 만들어져서 실행되도록 한다



## 멀티스레드 장단점

- 장점
  - 메모리 공간과 시스템 자원 소모가 줄어들게 된다
  - 스레드간 **스택 영역만 비공유**하고 **데이터 영역**과 동적으로 할당된 공간이 **힙(Heap)영역**을 공유하여 데이터를 주고받는다
  - 스레드간의 context switching(문맥 교환)은 프로세스 문맥 교환과는 달리 **캐시 메모리를 비울 필요가 없기** 때문에 더 빠르다
    즉, 시스템의 **처리량이 향상**되고 자원 소모가 줄어 자연스럽게 **응답 시간이 단축**된다
  - 자원공유를 효율적으로 할 수 있다
  - 작업이 분리되어 코드가 간결해진다
- 단점
  - 구현하기가 어렵다
  - 테스트, 디버깅 하기 어렵다
  - 전체프로세스에 영향을 준다
    - 여러 개의 자식 프로세스 중 하나에 문제가 발생하면 전체 프로세스가 영향을 받는다
  - 성능 저하가 동반된다
    - 너무 많은 스레드를 생성해서 사용하는 경우 성능이 더 떨어질 수 있다
    - 스레드가 CPU를 사용하기 위해서 작업간 전환을 해야 하는데, 이 작업간 전환은 많은 비용을 소모
  - 동기화에 주의해야한다
    - 동기화를 통해 작업 처리 순서를 컨트롤 하고 공유 자원에 대한 접근을 컨트롤 해야 한다
      But, 불필요한 부분까지 동기화를 할 경우 전체 성능에 영향을 미치게 된다
  - 교착상태가 발생하지 않도록 주의해야 한다
  - 각 스레드가 효율적으로 고르게 실행될 수 있도록 해야한다