## 교착상태(deadlock)

- 프로세스들이 서로 작업을 진행하지 못하고 영원히 대기 상태로 빠지는 현상

- 프로세스 사이에 할당된 자원의 충돌로 인하여 발생

- A와 B라는 2개의 프로세스가 각자 a와 b라는 지원을 할당 받아서 사용하고 있을 시 A는 작업을 계속 진행하기 위해 b라는 자원을 요청하고 B는 a라는 자원을 요청하게되면 각각의 프로세스가 요청한 자원이 이미 다른 프로세스에 할당되어 있기 때문에 할당이 풀릴 떄까지 대기 상태로 들어가게 됨
  즉, A와 B는 모두 상대방이 자원을 내놓기 기다리면서 영원히 대기 상태에 머무는 deadlock발생
  ![1576649040272](C:\Users\rlrlv\AppData\Roaming\Typora\typora-user-images\1576649040272.png)

- 발생 조건

  - 교착상태는 한 시스템 내에서 다음의 네 가지 조건이 동시에 성립 할 때 발생
  - 즉, 4가지 조건 중 하나라도 성립하지 않게 만든다면 교착상태 해결

  1. 상호 배제(Mutual exclution)
     자원은 한 번에 한 프로세스만 사용할 수 있다
  2. 점유 대기(Hold and wait)
     최소한 하나의 자원을 점유하고 있으면서 다른 프로세스에 할당되어 사용하고 있는 자원을 추가로 점유하기 위해 대기하는 프로세스가 있어야 한다
  3. 비선점(No preemption)
     다른 프로세스에 할당 된 자원을 강제로 빼앗을 수 없어야 한다
  4. 순환 대기(Circular wait)
     프로세스의 집합(P0 ... Pn)에서 P0는 P1이 점유한 자원을 대기하고 ... Pn은 P0가 점유한 자원을 요구해야 한다

- 해결 방안

  - 예방(Prevention)
    - 교착 상태 발생 조건중 하나를 제거함으로써 해결하는 방법 
    - 자원의 낭비가 심하다
      1. 상호 배제 부정
         여러 개의 프로세스가 공유 자원을 사용할 수 있도록
      2. 점유 대기 부정
         프로세스가 실행되기 전 필요한 모든 자원을 할당
      3. 비선점 부정
         자원을 점유하고 있는 프로세스가 다른 자원을 요구할 때 점유하고 있는 지원 반납하고
         요구한 자원을 사용하기 위해 기다리게 한다
      4. 순환 대기 부정
         자원에 고유한 번호를 할당하고, 번호 순서대로 자원을 요구하도록 한다
  - 회피(Avoidance)
    - 교착 상태가 발생하면 피해나가는 방법
      즉, 교착상태 가능성을 배제하지 않고 적절하게 피해나가는 방법
    - 은행원 알고리즘
      - 은행원 알고리즘이란 프로세스가 자원을 요구할 때 시스템은 자원을 할당한 후에도 안정 상태로 남아있게 되는지 사전에 검사하여 교착 상태를 회피하는 기법
      - 안전 상태에 있으면 자원할당, 그렇지 않으면 다른 프로세스들이 자원을 해지할 때까지 대기
  - 탐지 및 회복(Detect and Recovery)
    - 교착상태 발생을 허용하고 발생 시 회복시키는 방법
    - 자원 할당 그래프를 통해 교착 상태 탐지 가능
      ![1576650343952](C:\Users\rlrlv\AppData\Roaming\Typora\typora-user-images\1576650343952.png)
      - 프로세스 : Pi,  자원 : Rj
        Pi -> Rj : 자원 요청, Rj -> Pi : 자원 할당
      - 자원을 요청할 때마다 탐지 알고리즘을 실행하면 그에 대한 오버헤드가 발생
    - 회복(Recovery) 방법
      - 교착 상태를 일으킨 프로세스를 종료 or 할당된 자원을 해제함으로써 회복하는 것
      - 프로세스 종료하는 방법
        1. 교착 상태의 프로세스 **모두 중지**
        2. 교착 상태가 제거될 때까지 **한 프로세스씩 중지**
      - 자원 선점하는 방법
        1. 교착 상태의 프로세스가 점유하고 있는 자원을 **선점**(빼앗아)하여 다른 프로세스에게 할당, 해당 프로세스를 일시 정지시키는 방법
        2. **우선 순위**가 낮은 프로세스, **수행된 횟수**가 적은 프로세스 등을 위주로 프로세스의 자원을 선점(빼앗음)한다
  - 무시(Ignore)
    - 무시해도 좋을 확률로 데드락이 발생한다고 판단되면 그냥 무시
    - 교착 상태를 해결하려면 성능상 손해를 봐야 하기 때문