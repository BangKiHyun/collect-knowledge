## 쿠키와 세션(Cookie & Session)

#### 쿠키와 세션을 사용하는 이유

- HTTP 프로토콜의 특징이자 약점을 보완하기 위해서 사용한다.

- ##### HTTP 프로토콜의 특징(connectionless, stateless)

  - 비연결지향(Connectionless)

    클라이언트가 요청(req)을 한 후 응답(resp)을 받으면 그 연결을 끊어 버리는 특징

    HTTP는 먼저 클라이언트가 request를 서버에 보내면,
    서버는 클라이언트에게 요청에 맞는 response를 보내고 접속을 끊는 특성이 있다

    헤더에 keep-alive라는 값을 줘서 커넥션을 재활용하는데 HTTP1.1에서는 디폴트 값이다.

    HTTP가 TCP(연결지향)위에서 구현되었기 떄문에 네트워크 관점에서 keep-alive 옵션으로
    connectionless의 연결비용을 줄이는 것을 장점으로 비연결지향이라 한다.

  - 무상태(Stateless)

    연결을 끊는 순간 클라이언트와 서버의 통신이 끝나며 상태 정보는 유지하지 않는 특징

    HTTP의 이 두가지 특성을 보완하기 위해 쿠키와 세션을 사용한다.

    Connectionless라는 특성 덕분에 계속해서 통신 연결을 유지하지 않기 때문에 리소스 낭비가 줄어드는 것은 매우 큰 장점이지만
    틍신할 때마다 새로 Connection을 여기 때문에 클라이언트는 내가 누구인지 인증(로그인) 해야하는 단점이 있다.

    쿠키와 세션을 이용해서 단점을 보완할 수 있다.



#### 쿠키(Cookie)

- 쿠키는 **클라이언트(브라우저) 로컬에 저장**되는 키와 값이 들어있는 데이터 파일
- 사용자 인증이 유효한 시간을 명시할 수 있으며, 유효 시간이 정해지면 브라우저가 종료되어도 인증이 유지된다는 특징이 있다.
- Response Header에 Set-Cookie 속성을 사용하여 클라이언트에 쿠키를 만들 수 있다.
- 쿠키는 사용자가 따로 요청하지 않아도 브라우저가 Request시에 Request Header를 넣어서 자동으로 서버에 전송한다.



#### 쿠키 동작 방식

1. 클라이언트가 페이지를 요청
2. 서버에서 쿠키를 생성
3. HTTP Header에 쿠키를 포함 시켜 응답
4. 브라우저가 종료되어도 쿠키 만료 기간이 있다면 **클라이언트에서 보관**하고 있음
5. 같은 요청을 할 경우 HTTP Header에 쿠키를 함께 보냄
6. 서버에서 쿠키를 읽어 이전 상태 정보를 변경할 필요가 있을 때 쿠키를 업데이트하여 변경된 쿠키를 HTTP Header에 포함시켜 응답



#### 쿠키 사용 예

- 방문 사이트에서 로그인 시, "아이디와 비밀번호를 저장하시겠습니까?"
- 쇼핑몰의 장바구니 기능
- 자동로그인, 팝업 체크, 쇼핑몰 장바구니 등



#### 세션(Session)

- 세션을 쿠키를 기반으로 한다.
  하지만 사용자 정보 파일을 브라우저가 아닌 **서버 측에서 관리**한다.
- 서버에서는 클라이언트를 구분하기 위해 세션 ID를 부여하며 웹 브라우저가 서버에 접속해서 브라우저를 종료할 때까지 인증상태를 유지한다.
- 접속 시간에 제한을 두어 일정 시간 응답이 없다면 정보가 유지되지 않게 설정이 가능하다.
- 사용자에 대한 정보를 서버에 두기 때문에 쿠키보다 **보안에 좋지만**,
  사용자가 많아질수록 서버 메모리를 많이 차지하게 되는 단점이 있다.
- 즉 동접자 수가 많은 웹 사이트인 경우 서버에 과부하를 주게 되므로 성능 저하의 요인이 된다.



#### 세션 동작 방식

1. 클라이언트가 서버에 접속 시 세션 ID를 발급받는다.
2. 클라이언트는 세션ID에 대해 쿠키를 사용해서 저장하고 서버에 전달해서 사용한다.
3. 클라이언트는 서버에 요청할 때, 이 쿠키의 세션 ID를 서버에 전달해서 사용한다.
4. 서버는 전달받은 세션 ID를 통해 세션에 있는 클라이언트 정보를 가져온다.
5. 클라이언트 정보를 가지고 서버 요청을 처리하여 응답한다.



#### 세션의 특징

- 각 클라이언트에게 고유 ID를 부여
- 보안 면에서 쿠키보다 우수
- 사용자가 많아질수록 서버 메모리를 많이 차지(성능 저하)



#### 쿠키와 세션 차이점

​					쿠키				세션

저장 위치			클라이언트			웹 서버

저장 형식			text					Object

만료 시점			쿠키 저장시 설정		브라우저 종료시 삭제

자용되는 자원		클라이언트 리소스	웹 서버 리소스

속도				세션보다 빠름		쿠키보다 느림

보안				세션보다 안좋음		쿠키보다 좋음					