# Java Virtual Machine(JVM)

## JVM이란

운영체제 위에서 동작하는 프로세스로 **자바 코드를 컴파일해서 얻은 바이트 코드를 해당 운영체제가 이해할 수 있는 기계어로 바꿔 실행시켜주는 역할**을 한다

- 자바 가상 머신으로 자바와 운영체제 사이에서 중계자 역할을 한다.
- 자바가 운영체제 종류에 영향받지 않고 돌아갈 수 있도록 한다.
- 메모리 관리를 자동으로 해준다.(GC)

![image](https://user-images.githubusercontent.com/43977617/103003534-4faa0f00-4574-11eb-9656-920825224e20.png)

</br >

1. ### Class Loader

   자바에서 소스를 작성하면 .java파일이 생성된다. 이 소스를 java컴파일러가 컴파일하면 .class파일(바이트 코드)이 생성된다.
   
   이렇게 생성된 **클래스파일들**을 엮어서 JVM이 운영체제로부터 할당받은 메모리영역인 Runtime Data Area로 적재하는 역할을 Class Loader가 한다.

   </br >

2. ### Execution Engine

   Class Loader에 의해 **메모리에 적재된 클래스(바이트 코드)를 기계어로 변경해 명령어 단위로 실행하는 역할**을 한다. 

   - 명령어를 하나 하나 실행하는 인터프리터방식
   - JIT(Just-In-Time)컴파일러를 이용하는 방식이 있다.
  - JIT 컴파일러는 적절한 시간에 전체 바이트 코드를 네이티브 코드로 변경해서 Execution Engine이 네이티브로 컴파일된 코드를 실행하는 것으로 성능을 높이는 방식이다.
   
</br >
   
3. ### Garbage Collector(GC)

   - GC는 Heap 메모리 영역에 생성된 객체들 중에 **참조되지 않는 객체들을 탐색 후 제거하는 역할**을 한다.
   - GC가 수행되는 동안 GC를 수행하는 스레드가 아닌 다른 모든 스레드가 일시정지된다.
   - Full GC가 일어나서 모든 스레드가 정지한다면 장애로 이어지는 치명적인 문제가 생길 수 있다.

   </br >

4. ### Runtime Data Area

   - JVM의 메모리 영역으로 자바 애플리케이션을 실행할 때 사용되는 데이터들을 적재한는 영역

   **1. Method area (메소드 영역)**

   - 클래스 멤버 변수의 이름, 데이터 타입, 접근 제어자 정보같은 **필드 정보**
   - 메소드의 이름, 리턴 타입, 파라미터, 접근 제어자 정보같은 **메소드 정보**
   - Type정보(Interface인지 class인지), Constant Pool(상수 풀 : 문자 상수, 타입, 필드, 객체 참조가 저장됨), static 변수, final class 변수등이 생성되는 영역이다.

   </br >

   **2. Heap area (힙 영역)**

   - new 키워드로 생성된 객체와 배열이 생성되는 영역이다.
   - 메소드 영역에 로드된 클래스만 생성이 가능하고 **Garbage Collector가 참조되지 않는 메모리를 확인하고 제거하는 영역**이다.

   </br >

   **3. Stack area (스택 영역)**

   - 지역 변수, 파라미터, 리턴 값, 연산에 사용되는 임시 값등이 생성되는 영역이다.
   - int a = 10; 이라는 소스를 작성했다면 정수값이 할당될 수 있는 메모리공간을 a라고 잡아두고 그 메모리 영역에 값이 10이 들어간다.
     - 즉, 스택에 메모리에 이름이 a라고 붙여주고 값이 10인 메모리 공간을 만든다.
   - 클래스 Person p = new Person()
     - Stack area:  Person p는 스택 영역
     - Heap area: new로 생성된 Person 클래스의 인스턴스

   - 스택영역에 생성된 p의 값으로 힙 영역의 주소값을 가지고 있다. 즉, 스택 영역에 생성된 p가 힙 영역에 생성된 객체를 가리키고(참조하고) 있는 것이다.

   </br >

   **4. PC Register (PC 레지스터)**

   - Thread(쓰레드)가 생성될 때마다 생성되는 영역으로 Program Counter 즉, 현재 쓰레드가 실행되는 부분의 주소와 명령을 저장하고 있는 영역이다. (*CPU의 레지스터와 다름)
   - 이것을 이용해서 쓰레드를 돌아가면서 수행할 수 있게 한다.

   </br >

   **5. Native method stack**

   - 자바 외 언어로 작성된 네이티브 코드를 위한 메모리 영역이다.
   - 보통 C/C++등의 코드를 수행하기 위한 스택이다. (JNI)

   </br >

   쓰레드가 생성되었을 때 기준으로

   1, 2번인 메소드 영역과 힙 영역을 모든 **쓰레드가 공유**하고,

   3, 4, 5번인 스택 영역과 PC 레지스터, Native method stack은 각각의 쓰레드마다 생성되고 **공유되지 않는**다.

