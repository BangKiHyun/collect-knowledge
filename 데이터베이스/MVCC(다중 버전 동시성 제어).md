# MVCC(Multi-Version Concurrency Control)

## MVCC란?

- 동시 접근을 허용하는 데이터베이스에서 동시성을 제어하기 위해 사용하는 방법 중 하나
- MVCC모델에서 데이터에 접근하는 사용자는 접근한 시점에서 데이터베이스의 Snapshot을 읽는다.
- snapshot 데이터에 대한 변경이 완료될 떄(트랜잭션이 commit 될 때) 까지 만들어진 변경사항은 다른 데이터베이스 사용자가 볼 수 없다.
- 사용자가 데이터를 업데이트하면 이전의 데이터를 덮어 씌우는게 아니라 **새로운 버전의 데이터를 UNDO 영역에 생성**한다. 대신 이전 버전의 데이터와 비교해서 변경된 내용을 기록한다.
- 결국 **마지막 버전의 데이터를 읽게 된다**.

</br >

## MVCC 절차

- 갱신 시 기존 데이터 값은 DB Rollback Segment에 기록
- 다른 세션은 트랜잭션이 commit 전까지 이전 버전 정보 조회하여 일관성 보장

</br >

## MVCC 원리

- 이전 데이터 값 저장
- 데이터 변경 시 마다 Undo 영역에 저장
- SCN값 기준 Rollback Segment/Undo 영역 기반 동시성 관리
  - SCN(System Change Number): 이전 데이터를 얻기 위해 트랜잭션이 commit될 때 마다 증가

## 특징

- 일반적인 RDBMS보다 매우 빠르게 작동
  - 잠금을 사용하지 않는 일관된 읽기를 제공하기 때문
- 사용하지 않는 데이터가 계속 쌓이게 되므로 데이터를 정리하는 시스템 필요
  - 데이터를 읽기 시작할 때, 다른 사람이 그 데이터를 삭제하거나 수정하더라도 영향을 받지 않고 데이터를 사용할 수 있기 때문에 사용하지 않는 데이터가 쌓이게 되는것.
- 데이터 버전이 충돌하면 애플리케이션 영역에서 이러한 문제를 해결해야 함
  - 하나의 데이터에 대한 여러 버전의 데이터를 허용하기 때문

